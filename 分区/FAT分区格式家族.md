### FAT文件系统
这是一个关于 FAT 文件系统的文档，该文件基于 FAT32 文件系统规范（以下称为 FAT 规范（FAT specs））编写，以了解 FAT 文件系统的工作原理以及如何管理它。 它是根据 FAT 规范的内容和标准系统（实际的 DOS 和 Windows）的行为编写的，因而，相比 FAT 规范有许多改进和省略。 如果标准系统的行为与 FAT 规范不同，则它是根据实际系统而不是 FAT 规范编写的。并且本文档中可能存在任何意外或预期的错误，因此您需要参考 FAT 文件系统的源文件，并在编写 FAT 驱动程序或实用程序时确保实际系统的行为。对于 exFAT 文件系统
### 文件系统基础
#### FAT卷（FAT Volume）
FAT 文件系统将自身称为逻辑卷（或逻辑驱动器）。 FAT 逻辑卷由三个或四个区域组成，每个区域由一个或多个扇区组成，并按以下顺序位于卷上。 （FAT volume map 即下图。后文的介绍都是基于该图示来说明的）
![[Pasted image 20230731120838.png]]
1. Reserved area (volume configuration data) 保留区域(卷配置数据)
2. FAT area (allocation table for data area) FAT区域（数据区域的分配表）
3. Root directory area (not present on FAT32 volume) 根目录区域(FAT32 卷上不存在)
4. Data area (contents of file and directory) 数据区（文件和目录的内容）
#### 扇区
扇区是存储器上读写存储设备的最小数据块单元。 一般的扇区大小为 512 字节，有时某些类型的存储介质会使用更大的扇区。 存储设备上的每个扇区由从存储设备顶部按顺序分配的扇区号寻址。 由于卷不总是位于存储器的顶部，因此在本文档中，“扇区号” 表示从卷顶部开始的相对位置，“物理扇区号” 表示从存储设备顶部开始的绝对位置。
#### 存储器上的数据形式
FAT 文件系统最初是为使用 x86 处理器的 IBM PC 开发的。 最重要的是存储器上的 FAT 文件系统中的数据结构以小端模式存储的。 如果访问 FAT 文件系统的平台的体系结构是大端模式，那么在访问 FAT 文件系统的结构时需要进行字节序转换。 此外，含多个字节的字数据并不总是与字边界对齐的。 如果处理器无法访问未对齐的字数据，则需要逐字节访问数据。 因此，以 C 结构成员的方式访问 FAT 卷会丢弃代码可移植性。 以以字节为单位的简单字节数组而不是 C 结构成员的方式访问 FAT 卷，可提供最佳的代码可移植性。
#### 引导扇区和BPB
FAT 卷中最重要的数据结构是 BPB（BIOS Parameter Block，BIOS 参数块），其中存储 FAT 卷的配置参数。 BPB 位于引导扇区中。 引导扇区通常称为 VBR（Volume Boot Record，卷引导记录）或 PBR（Private Boot Record，专用引导记录），但它只是保留区域的第一个扇区，即卷的第一个扇区。
随着 FAT 文件系统功能的增强，BPB 经常被更改。 发生的第一次混乱是由于 BPB 的第一次出现。 在 MS-DOS Ver.1 中，引导扇区中没有 BPB。 在 FAT 文件系统的第一个版本中只有少数磁盘格式（单面和双面 5.25 英寸软盘），并且磁盘格式是通过参考引导扇区的后一个扇区的开始的第一个字节（第一个字节的低 8 位）来确定。


### 参考文章
- https://blog.csdn.net/ZCShouCSDN/article/details/97610903
